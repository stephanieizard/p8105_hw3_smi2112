---
title: "hw3_q3"
author: "Stephanie Izard"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(ggridges)
```

##Problem 3

Loading NY NOAA data:

```{r cache = TRUE}
ny_noaa <- p8105.datasets::ny_noaa
```

Short description of dataset:

The size of the dataset is `r dim(ny_noaa)` (2595176 observations/ rows and 7 variables/ columns) and is in long format. The variable "id" is weather station ID, "date" is the date of observation, "prcp" is amount of precipitation measured in tenth of mm, "snow" is amount of snowfall measured in mm, "snwd" is snow depth measured in mm, "tmax" is the maximum temperature measured in tenths of degrees C, and "tmin" is the minimum temperature measured in tenths of degrees C. The dataset contains extensive missing data, as each weather station may only collect a subset of these variables. The table created below (missing_data) summarizes the proportion of missing variables at each station.

```{r}
missing_data <- ny_noaa %>% 
  group_by(id) %>% 
  summarize_all(funs(mean(is.na(.))))
```

Data cleaning:

```{r}
ny_noaa <- ny_noaa %>% 
  separate(date, into = c("year", "month", "day"), sep = "-") %>% 
  mutate(year, as.integer(year)) %>%
  mutate_at(vars(prcp:tmin), as.numeric) %>% 
  mutate(tmax = tmax / 10,
         tmin = tmin / 10,
         prcp = prcp / 100, 
         snow = snow / 10, 
         snwd = snwd / 10)
```

Date was sepparated into year, month, and day. Maximum and minimum temperature were changed from tenths of degrees C to degrees C. Precipitation was changed from tenths of a mm to cm. Snowfall and snow depth were changed from mm to cm.

The most commonly observed snowfall value is 0 cm. The second most commonly observed snowfall is 2.5 cm.

```{r}
ny_noaa %>% 
  group_by(snow) %>% 
  summarize(n = n()) %>% 
  arrange(desc(n))
```

Two-panel plot showing the average max temperature in January and in July in each station across years:

```{r}
ny_noaa %>% 
  filter(month == "01" | month == "07") %>% 
  mutate(month = if_else(month == "01", "January", "July")) %>% 
  group_by(id, year, month) %>% 
  summarize(avg_tmax = mean(tmax, na.rm = TRUE)) %>% 
  ggplot(aes(x = year, y = avg_tmax, group = id)) +
  geom_line(color = "darkslateblue") +
  facet_grid(~ month) +
  labs(title = "Average maximum temperature at each site in January and July from 1981 to 2010 in NYS", x = "Year", y = "Temperature (Degrees C)") +
  theme_bw()
```

Two-panel plot showing (i) tmax vs tmin for the full dataset and (ii) the distribution of snowfall values between 0 and 100 separately by year.

```{r}
library(patchwork)

plot1 <- ggplot(ny_noaa, aes(x = tmax, y = tmin)) +
  geom_hex() +
  labs(title = "Maximum by minimum temperature", x = "Maximum temperature (Degrees C)", y = "Minimum temperature (Degrees C)") +
  viridis::scale_fill_viridis(option = "plasma") + 
  theme_bw()

plot2 <- ny_noaa %>% 
  filter(snow >= 0 & snow <= 100) %>% 
  ggplot(aes(x = snow, y = year)) +
  geom_density_ridges(scale = 0.9, fill = "darkred") + 
  labs(title = "Snow fall distribution per year", x = "Snowfall (cm)", y = "Year") +
  theme_bw()

plot1 + plot2
```




